<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Snake</title>
    <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script>
    <script src="./components/slither.js"></script>
    <script src="./components/wasd-save.js"></script>
    <script>
// modified from https://github.com/ngokevin/kframe
AFRAME.registerComponent("entity-generator", {
  schema: {
    mixin: { default: "" },
    num: { default: 15 }
  },

  init: function() {
    // Create entities with supplied mixin.
    for (var i = 0; i < this.data.num; i++) {
      var entity = document.createElement("a-entity");
      entity.setAttribute("mixin", this.data.mixin);
      this.el.appendChild(entity);
    }
  }
});

// modified from https://github.com/ngokevin/kframe
AFRAME.registerComponent("random-position", {
  schema: {
    min: { default: { x: -20, y: -20, z: -20 }, type: "vec3" },
    max: { default: { x: 20, y: 20, z: 20 }, type: "vec3" },
    step: { default: 2.5, type: "number" },
    fixedY: { type: "number" }
  },

  update: function() {
    var max = this.data.max;
    var min = this.data.min;
    var step = this.data.step;
    var posY = (this.data.fixedY !== undefined) ?
      this.data.fixedY :
      Math.floor(Math.random() * ((max.y - min.y) / step)) * step + min.y;

    this.el.setAttribute("position", {
      x: Math.floor(Math.random() * ((max.x - min.x) / step)) * step + min.x,
      y: posY,
      z: Math.floor(Math.random() * ((max.z - min.z) / step)) * step + min.z
    });
  }
});

document.addEventListener("DOMContentLoaded", function() {
  const scene = document.querySelector("a-scene");

  const head = document.createElement("a-entity");
  head.setAttribute("mixin", "sphere");
  head.setAttribute("position", "0 1.25 -5");
  head.setAttribute("wasd-save", true);
  head.setAttribute("slither", {
    delay: 1000,
    animDuration: 100
  });
  scene.appendChild(head);

  const ray = document.createElement("a-entity");
  ray.setAttribute("raycaster", { showLine: true });
  ray.setAttribute("rotation", "0 270 0");
  head.appendChild(ray);

  const body1 = document.createElement("a-entity");
  body1.setAttribute("mixin", "sphere");
  body1.setAttribute("position", "-2.5 1.25 -5");
  body1.setAttribute("slither", {
    delay: 1000,
    animDuration: 100,
    follow: head
  });
  scene.appendChild(body1);

  const body2 = document.createElement("a-entity");
  body2.setAttribute("mixin", "sphere");
  body2.setAttribute("position", "-5 1.25 -5");
  body2.setAttribute("slither", {
    delay: 1000,
    animDuration: 100,
    follow: body1
  });
  scene.appendChild(body2);
});
</script>
  </head>
  <body>

    <a-scene id="scene">
      <a-assets>
        <img id="poolTx" src="./textures/8ball.jpg" />
        <a-mixin id="sphere" geometry="primitive: sphere; radius: 1.25" material="src: #poolTx"></a-mixin>
        <a-mixin id="obstacle" geometry="primitive: box; width: 5; height: 2.5" random-position="fixedY: 1.25"></a-mixin>
      </a-assets>
      <a-plane position="-12.5 0 -4" rotation="-90 0 0" width="100" height="100" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
      <a-entity entity-generator="mixin: obstacle"></a-entity>
      <a-entity position="0 1.6 10">
        <a-camera></a-camera>
      </a-entity>
    </a-scene>


  </body>
</html>
