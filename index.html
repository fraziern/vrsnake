<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Snake</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script>
    <script src="./components/slither-once.js"></script>
    <script src="./components/wasd-save.js"></script>
    <script src="./components/commander.js"></script>
    <script src="./components/collider-check.js"></script>
    <script src="./components/utils.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", function() {
  const scene = document.querySelector("a-scene");

  const head = document.createElement("a-entity");
  head.setAttribute("mixin", "sphere");
  head.setAttribute("position", "0 1.25 -5");
  head.setAttribute("collider-check", {
    textOutput: document.querySelector("#textOutput")
  });
  scene.appendChild(head);

  const ray = document.createElement("a-entity");
  ray.setAttribute("raycaster", {
    showLine: true,
    far: 1.5,
    direction: { x: 1, y: 0, z: 0 }
  });
  head.appendChild(ray);

  scene.setAttribute("snakeController", { head });
  scene.setAttribute("wasd-save", true);

  scene.addEventListener("bad-collision", () => {
    head.pause();
    const sky = document.querySelector("#sky");
    sky.setAttribute("color", "red");
  });

  scene.addEventListener("gobbled-apple", () => {
    // remove apple
    if (event.detail.classList.contains("apple")) {
      event.detail.parentNode.removeChild(event.detail);
    }
    // add body
    scene.emit("add-body", null);
    // TODO: check if won
  });
});
</script>
  </head>
  <body>
    <div class="textOutput" id="textOutput"></div>

    <a-scene id="scene">
      <a-assets>
        <img id="poolTx" src="./textures/8ball.jpg" />
        <a-mixin id="sphere" class="snakeBody" geometry="primitive: sphere; radius: 1.25" material="src: #poolTx"></a-mixin>
        <a-mixin id="obstacle" geometry="primitive: box; width: 5; height: 2.5" random-position="fixedY: 1.25"></a-mixin>
        <a-mixin id="apple" geometry="primitive: sphere; radius: .75" random-position="fixedY: .75" material="color: #eb3232"></a-mixin>
      </a-assets>
      <a-plane position="-12.5 0 -4" rotation="-90 0 0" width="100" height="100" color="#7BC8A4"></a-plane>
      <a-sky id="sky" color="#ECECEC"></a-sky>
      <a-entity entity-generator="mixin: obstacle"></a-entity>
      <a-entity entity-generator="mixin: apple"></a-entity>
      <a-entity position="0 1.6 10">
        <a-camera></a-camera>
      </a-entity>
    </a-scene>


  </body>
</html>
